{
  "name": "${localWorkspaceFolderBasename}",

  // Use DDEV's docker-compose.yaml
  "dockerComposeFile": "../.ddev/.ddev-docker-compose-full.yaml",
  "service": "web",
  "workspaceFolder": "/var/www/html",

  // Stop the docker-compose stack when the devcontainer is closed
  "shutdownAction": "stopCompose",

  // Ensure DDEV is running before opening (restart to handle unclean shutdowns)
  "initializeCommand": "bash -c 'ddev restart -y && for i in {1..60}; do ddev describe >/dev/null 2>&1 && break || sleep 1; done'",

  // Wait for DDEV to be fully ready
  "waitFor": "initializeCommand",

  // Set up the container for VS Code
  // DDEV automatically maps the host user into the container and runs Apache/FPM as that user
  // This ensures CLI and HTTP share the same cache directory (silverstripe-cache/<username>)
  // No explicit containerUser needed - DDEV handles this automatically

  "customizations": {
    "vscode": {
      "extensions": [
        // PHP
        "phpactor.vscode-phpactor",
        "junstyle.php-cs-fixer",
        "xdebug.php-debug",

        // SilverStripe
        "adrian.silverstripe",

        // JavaScript/TypeScript
        "biomejs.biome",

        // Utilities
        "berublan.vscode-log-viewer",
        "editorconfig.editorconfig",
        "mikestead.dotenv",
        "mhutchie.git-graph"
      ],

      "settings": {

        // VS Code PHP
        "vscode.php-language-features": false,
        // PHP Settings (now running IN container)
        "php.validate.executablePath": "/usr/bin/php",

        // Phpactor
        "phpactor.enable": true,
        "phpactor.path": "/usr/local/bin/phpactor",

        // PHP CS Fixer
        "php-cs-fixer.executablePath": "${workspaceFolder}/vendor/bin/php-cs-fixer",
        "php-cs-fixer.onsave": true,
        "php-cs-fixer.rules": "@PSR12",

        // Biome (only for themes/default)
        "biome.enabled": false,
        "biome.lsp.bin": "${workspaceFolder}/themes/default/node_modules/.bin/biome",

        // Editor
        "[php]": {
          // "editor.defaultFormatter": "bmewburn.vscode-intelephense-client"
          "editor.defaultFormatter": "junstyle.php-cs-fixer"
        },
        "[javascript]": {
          "editor.defaultFormatter": "biomejs.biome"
        },
        "[typescript]": {
          "editor.defaultFormatter": "biomejs.biome"
        },
        "[json]": {
          "editor.defaultFormatter": "biomejs.biome"
        },
        "[jsonc]": {
          "editor.defaultFormatter": "biomejs.biome"
        },

        "editor.linkedEditing": true,
        "editor.stickyScroll.enabled": true,
        "workbench.tree.enableStickyScroll": true,
        "workbench.editorAssociations": {
          "*.svg": "default"
        },
        // Terminal
        "terminal.integrated.scrollback": 10000,
        "terminal.integrated.defaultProfile.linux": "bash",

        // Search
        "search.followSymlinks": false,
        "search.useIgnoreFiles": false,

        // Log Viewer
        "logViewer.watch": [
          {
            "title": "Silverstripe",
            "pattern": "silverstripe.log"
          }
        ],

        // Telemetry
        "telemetry.telemetryLevel": "off"
      }
    }
  },

  "portsAttributes": {
    "5173": {
      "label": "Vite",
      "onAutoForward": "silent"
    },
    "9003": {
      "label": "Xdebug",
      "onAutoForward": "silent"
    }
  },

  // Run commands after container is created/started
  "postCreateCommand": "bash -c 'cd themes/default && npm install && mkdir -p $HOME/.local/share/phpactor'"
}
